<!DOCTYPE html>
<html>
<head>
  <title>Soulmate Calculator</title>
</head>
<body>
  <div class="titles">
    <h1>It's cuffing season!</h1>
    <h3>Answer a few questions to figure out the chance of finding your soulmate</h3>
  </div>
  
  <label for="sex">I am looking for someone who is</label>
  <select id="sex" name="sex">
    <option value="male">Male</option>
    <option value="female">Female</option>
  </select>
  
  <label for="age">&#128116; Age</label>
  <select id="age" name="age">
    <option value="20-24">20-24</option>
    <option value="25-29">25-29</option>
    <option value="30-34">30-34</option>
    <option value="35-39">35-39</option>
    <option value="40-44">40-44</option>
    <option value="45-50">45-50</option>
    <option value="51-55">51-55</option>
    <option value="56-60">56-60</option>
    <option value="61-65">61-65</option>
    <option value="66-70">66-70</option>
    <option value="71-75">71-75</option>
    <option value="76-80">76-80</option>
    <option value="81">81+</option>
  </select>

  <label for="hair">&#128525; Hair Color</label>
  <select id="hair" name="hair">
    <option value="blackHair">Black</option>
    <option value="brownHair">Brown</option>
    <option value="blondeHair">Blonde</option>
    <option value="redHair">Red</option>
  </select>

  <label for="eye">&#128563; Eye Color</label>
  <select id="eye" name="eye">
    <option value="blueEye">Blue</option>
    <option value="brownEye">Brown</option>
    <option value="greenEye">Green or other</option>
  </select>

  <label for="height">&#128200; Height</label>
  <select id="height" name="height">
    <option value="underFive">Less than 5 feet tall</option>
    <option value="fivePlus">5' - 5'3"</option>
    <option value="fiveThreePlus">5'4" - 5'6"</option>
    <option value="fiveSixPlus">5'7" - 5'9"</option>
    <option value="fiveNinePlus">5'9" - 5'11"</option>
    <option value="moreThanSix">More than 6 feet tall</option>
  </select>

  <label for="income">&#128176; Household Income</label>
  <select id="income" name="income">
    <option value="any">Doesn't matter to me</option>
    <option value="25">More than $25k</option>
    <option value="50">More than $50k</option>
    <option value="100">More than $100k</option>
    <option value="200">More than $200k</option>
  </select>

  <div class="disclaimer">
    <p>Apologetic disclaimer: much of this data is from the US Census, which only has data for "Male" and "Female". I recognize that this excludes many people and makes the Soulmate Calculator less fun.</p>
  </div>

  <button onclick="saveValues()">Calculate</button>

  <div class="probability-section">
    <h2>Chance of meeting your soulmate in a.....</h2>

    <!-- Probability labels display -->
    <div class="probability-labels">
        <div>Room of 100 People</div>
        <div>Room of 200 People</div>
        <div>Room of 500 People</div>
        <div>Room of 1000 People</div>
    </div>

    <!-- Probability values display -->
    <div class="probability-values">
        <div id="prob-100">Placeholder</div>
        <div id="prob-200">Placeholder</div>
        <div id="prob-500">Placeholder</div>
        <div id="prob-1000">Placeholder</div>
    </div>
</div>

  <canvas id="histogramChart" width="400" height="200"></canvas>
  <div id="container"></div>

  <script type="module">

    import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

    // const ageandincomedata = await d3.csv("data/ageandincome2022.csv");
    const ageandsexdata = await d3.csv("data/ageandsex2022.csv");
    const popprofilehousingdata = await d3.csv("data/popprofilehousing2020.csv");
    const weightsdata = await d3.csv("data/weights.csv");
    const numMales = 165228214
    const numFemales = 168059348
    const numPeople = 333287562

    const chanceMale = numMales / numPeople
    const chanceFemale = numFemales / numPeople

    var ageAndSexData = {
      "20-24": {'male': 11488577/numPeople, 'female': 10957463/numPeople},
      "25-29": {'male': 11245260/numPeople, 'female': 10762368/numPeople},
      "30-34": {'male': 11785090/numPeople, 'female': 11440546/numPeople},
      "35-39": {'male': 11322522/numPeople, 'female': 11013337/numPeople},
      "40-44": {'male': 10939843/numPeople, 'female': 10771942/numPeople},
      "45-50": {'male': 9853198/numPeople, 'female': 9787727/numPeople},
      "51-55": {'male': 10447394/numPeople, 'female': 10388127/numPeople},
      "56-60": {'male': 10163454/numPeople, 'female': 10390161/numPeople},
      "61-65": {'male': 10492488/numPeople, 'female': 11081365/numPeople},
      "66-70": {'male': 8798968/numPeople, 'female': 9760529/numPeople},
      "71-75": {'male': 7149850/numPeople, 'female': 8188725/numPeople},
      "76-80": {'male': 4901587/numPeople, 'female': 6103874/numPeople},
      "81": {'male': 2213087/numPeople, 'female': 3946856/numPeople}
    }


    var householdIncomeData = {
    "0": {0: 718818, 10000: 718818, 15000: 258998, 20000: 315881, 25000: 296331, 30000: 341999, 35000: 294764, 40000: 315664, 45000: 243175, 50000: 474780, 60000: 574788, 75000: 578015, 100000: 300929, 125000: 140104, 150000: 111129, 200000: 78652},
    "25": {0: 1951920, 10000: 926285, 15000: 800098, 20000: 1095127, 25000: 1159690, 30000: 1466250, 35000: 1355753, 40000: 1564254, 45000: 1386158, 50000: 3006782, 60000: 4305239, 75000: 6153740, 100000: 4936590, 125000: 3482583, 150000: 4182808, 200000: 5001113},
   "45": {0: 2298892, 10000: 1497958, 15000: 1113994, 20000: 1190739, 25000: 1202878, 30000: 1347782, 35000: 1291127, 40000: 1421107, 45000: 1281853, 50000: 2758946, 60000: 3918418, 75000: 5849072, 100000: 4933555, 125000: 3731699, 150000: 5062628, 200000: 7382159},
    "65": {0: 2149924, 10000: 2120073, 15000: 2025934, 20000: 2012195, 25000: 1846766, 30000: 1763352, 35000: 1653876, 40000: 1579886, 45000: 1446731, 50000: 2693233, 60000: 3363896, 75000: 4069942, 100000: 2682639, 125000: 1736903, 150000: 1916446, 200000: 2416852}
    };

    var eyeColorProbs = {'blue': .45, 'brown': .27, 'green': .28}
    var hairColorProbs = {'black': .85, 'brown': .11, 'blonde': .02, 'red': .01}

    var femaleAgeAndHeightPercentiles = {
      20: {.05: 59.0, .1: 60.0, .15: 60.6, .25: 61.6, .5: 63.5, .75: 65.3, .85: 66.3, .9: 67.0, .95: 67.9},
      30: {.05: 59.5, .1: 60.7, .15: 61.2, .25: 62.2, .5: 64.0, .75: 66.0, .85: 67.0, .9: 67.5, .95: 68.3},
      40: {.05: 59.3, .1: 60.2, .15: 60.9, .25: 62.1, .5: 64.0, .75: 65.6, .85: 66.7, .9: 67.5, .95: 68.6},
      50: {.05: 59.3, .1: 60.2, .15: 60.7, .25: 61.6, .5: 63.4, .75: 65.3, .85: 66.4, .9: 67.0, .95: 67.5},
      60: {.05: 58.8, .1: 60.1, .15: 60.6, .25: 61.4, .5: 63.3, .75: 65.1, .85: 66.0, .9: 66.5, .95: 67.6},
      70: {.05: 58.1, .1: 59.3, .15: 60.0, .25: 60.6, .5: 62.2, .75: 64.0, .85: 64.9, .9: 65.3, .95: 66.2},
      80: {.05: 57.2, .1: 57.9, .15: 58.8, .25: 59.6, .5: 61.3, .75: 62.9, .85: 63.7, .9: 64.4, .95: 65.6},
    }

    var maleAgeAndHeightPercentiles = {
      20: {.05: 64.8, .1: 65.8, .15: 66.3, .25: 67.3, .5: 69.3, .75: 71.0, .85: 72.1, .9: 72.8, .95: 73.6},
      30: {.05: 64.4, .1: 65.6, .15: 66.4, .25: 67.4, .5: 69.6, .75: 71.4, .85: 72.6, .9: 73.3, .95: 74.3},
      40: {.05: 64.4, .1: 65.4, .15: 66.3, .25: 67.5, .5: 69.5, .75: 71.4, .85: 72.0, .9: 72.8, .95: 74.2},
      50: {.05: 64.1, .1: 65.0, .15: 66.0, .25: 67.0 , .5: 69.0, .75: 71.1, .85: 72.1, .9: 72.8, .95: 73.9},
      60: {.05: 64.0, .1: 64.9, .15: 65.7, .25: 66.7, .5: 68.6, .75: 70.4, .85: 71.7, .9: 72.3, .95: 72.8},
      70: {.05: 63.6, .1: 64.8, .15: 65.4, .25: 66.4, .5: 68.1, .75: 69.9, .85: 70.6, .9: 71.8, .95: 72.7},
      80: {.05: 62.0, .1: 63.4, .15: 64.2, .25: 65.3, .5: 67.1, .75: 69.0, .85: 70.2, .9: 70.7, .95: 71.8},
    }

    window.saveValues = function() {
        var selectedGender = document.getElementById("sex").value;
        var selectedAge = document.getElementById("age").value;
        var selectedHair = document.getElementById("hair").value;
        var selectedEye = document.getElementById("eye").value;
        var selectedHeight = document.getElementById("height").value;
        var selectedIncome = document.getElementById("income").value;

        const allTheThings = [selectedGender, selectedAge, selectedHair, selectedEye, selectedHeight, selectedIncome]
        console.log(allTheThings)
        console.log('[gender, age, hair, eye, height, income]')

        if (selectedGender == "male") { //they are male
            const chanceOfAge = ageAndSexData[selectedAge]["male"]
            var chanceOfEarnings = 1
            if (selectedAge == "20-24") { //0 in income data
              var totalEarningsUnder25 = householdIncomeData["0"][0] + householdIncomeData["0"][10000] + householdIncomeData["0"][15000] + householdIncomeData["0"][20000] + householdIncomeData["0"][25000] + householdIncomeData["0"][30000] + householdIncomeData["0"][35000] + householdIncomeData["0"][40000] + householdIncomeData["0"][45000] + householdIncomeData["0"][50000] + householdIncomeData["0"][55000] + householdIncomeData["0"][60000]+ householdIncomeData["0"][75000] + householdIncomeData["0"][100000] + householdIncomeData["0"][125000] + householdIncomeData["0"][150000] + householdIncomeData["0"][200000]
              if (selectedIncome == "any") {
                var chanceOfEarnings = 1
              } else if (selectedIncome == "25") {
                var chanceOfEarnings = (householdIncomeData["0"][25000] + householdIncomeData["0"][30000] + householdIncomeData["0"][35000] + householdIncomeData["0"][40000] + householdIncomeData["0"][45000] + householdIncomeData["0"][50000] + householdIncomeData["0"][55000] + householdIncomeData["0"][60000] + householdIncomeData["0"][75000] + householdIncomeData["0"][100000] + householdIncomeData["0"][125000] + householdIncomeData["0"][150000] + householdIncomeData["0"][200000]) / totalEarningsUnder25
              } else if (selectedIncome == "50") {
                var chanceOfEarnings = (householdIncomeData["0"][50000] + householdIncomeData["0"][55000] + householdIncomeData["0"][60000] + householdIncomeData["0"][75000] + householdIncomeData["0"][100000] + householdIncomeData["0"][125000] + householdIncomeData["0"][150000] + householdIncomeData["0"][200000]) / totalEarningsUnder25
              } else if (selectedIncome == "100") {
                var chanceOfEarnings = (householdIncomeData["0"][100000] + householdIncomeData["0"][125000] + householdIncomeData["0"][150000] + householdIncomeData["0"][200000]) / totalEarningsUnder25
              } else if (selectedIncome == "200") {
                var chanceOfEarnings = (householdIncomeData["0"][200000]) / totalEarningsUnder25
              } 
              console.log('chance of age = ', chanceOfAge)
              console.log('new total earnings under 25 = ', totalEarningsUnder25)
              console.log('chance of earnings = ', chanceOfEarnings)
            } else if (selectedAge == "25-29") { //0
                
            } else if (selectedAge == "30-34") { //0
                
            } else if (selectedAge == "35-39") { //0
                
            } else if (selectedAge == "40-44") { //0
                
            } else if (selectedAge == "45-50") { //0
                
            } else if (selectedAge == "51-55") { //0
                
            } else if (selectedAge == "56-60") { //0
                
            } else if (selectedAge == "61-65") { //0
                
            } else if (selectedAge == "61-65") { //0
                
            } else if (selectedAge == "66-70") { //0
                
            } else if (selectedAge == "71-75") { //0
                
            } else if (selectedAge == "76-80") { //0
                
            } else if (selectedAge == "81") { //0
                
            }
        } else { //then they are female

        }

        var probabilities = generateProbabilities();

        // Update the displayed probabilities
        updateProbabilityDisplay(probabilities);
        
    }

    function generateProbabilities() {
        // For demonstration purposes, generate random probabilities.
        return {
            prob100: Math.random() * 100,
            prob200: Math.random() * 100,
            prob500: Math.random() * 100,
            prob1000: Math.random() * 100,
        };
    }

    function updateProbabilityDisplay(probabilities) {
        document.getElementById("prob-100").innerText = `100 People: ${probabilities.prob100.toFixed(2)}%`;
        document.getElementById("prob-200").innerText = `200 People: ${probabilities.prob200.toFixed(2)}%`;
        document.getElementById("prob-500").innerText = `500 People: ${probabilities.prob500.toFixed(2)}%`;
        document.getElementById("prob-1000").innerText = `1000 People: ${probabilities.prob1000.toFixed(2)}%`;
    }

    // Declare the chart dimensions and margins.
    const width = 640;
    const height = 400;
    const marginTop = 20;
    const marginRight = 20;
    const marginBottom = 30;
    const marginLeft = 40;
    
    // Declare the x (horizontal position) scale.
    const x = d3.scaleUtc()
        .domain([new Date("2023-01-01"), new Date("2024-01-01")])
        .range([marginLeft, width - marginRight]);
    
    // Declare the y (vertical position) scale.
    const y = d3.scaleLinear()
        .domain([0, 100])
        .range([height - marginBottom, marginTop]);
    
    // Create the SVG container.
    const svg = d3.create("svg")
        .attr("width", width)
        .attr("height", height);
    
    // Add the x-axis.
    svg.append("g")
        .attr("transform", `translate(0,${height - marginBottom})`)
        .call(d3.axisBottom(x));
    
    // Add the y-axis.
    svg.append("g")
        .attr("transform", `translate(${marginLeft},0)`)
        .call(d3.axisLeft(y));
    
    // Append the SVG element.
    container.append(svg.node());
    
    </script>


  <style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        text-align: center;
        margin: 20px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #E68798
    }

    select {
        width: 200px;
        padding: 8px;
        margin-bottom: 16px;
        font-size: 16px;
    }

    button {
        background-color: #E68798;
        color: white;
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        cursor: pointer;
    }

    button:hover {
        background-color: #d63a56;
    }

    .disclaimer {
            font-size: 12px;
            color: #777;
            margin-top: 10px;
    }

    .probability-section {
            margin-top: 40px;
    }

    .probability-values {
            display: flex;
            justify-content: space-around;
            align-items: center; /* Align labels and values vertically */
            margin-top: 20px;
    }

    .probability-labels div,
    .probability-values div {
        width: 150px;
        padding: 10px;
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        margin-bottom: 10px;
    }

    .probability-labels {
        display: flex;
        justify-content: space-around;
        align-items: center; /* Align labels and values vertically */
        width: 600px;
        margin: 0 auto;
        margin-bottom: 10px;
    }

    .titles {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #E68798
    }
  </style>
</body>
</html>
